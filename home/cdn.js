// 完整的 Cloudflare CDN 节点城市映射表（已合并）
const cdnLocationMap = {
    // 亚洲
    "HKG": "香港, 中国",
    "TPE": "台北, 中国台湾",
    "NRT": "东京, 日本",
    "SIN": "新加坡",
    "BKK": "曼谷, 泰国",
    "ICN": "首尔, 韩国",
    "DEL": "德里, 印度",
    "BOM": "孟买, 印度",
    "KUL": "吉隆坡, 马来西亚",
    "CGK": "雅加达, 印度尼西亚",
    "MNL": "马尼拉, 菲律宾",
    "DAC": "达卡, 孟加拉国",
    "KTM": "加德满都, 尼泊尔",
    "PBH": "廷布, 不丹",
    "PNH": "金边, 柬埔寨",
    "HAN": "河内, 越南",
    "SGN": "胡志明市, 越南",
    "VTE": "万象, 老挝",
    "RGN": "仰光, 缅甸",
    "ULN": "乌兰巴托, 蒙古",
    "EVN": "埃里温, 亚美尼亚",
    "DXB": "迪拜, 阿联酋",
    "AUH": "阿布扎比, 阿联酋",
    "DOH": "多哈, 卡塔尔",
    "BAH": "麦纳麦, 巴林",
    "KWI": "科威特城, 科威特",
    "MCT": "马斯喀特, 阿曼",
    "JED": "吉达, 沙特阿拉伯",
    "RUH": "利雅得, 沙特阿拉伯",
    "TLV": "特拉维夫, 以色列",
    "AMM": "安曼, 约旦",
    "BEY": "贝鲁特, 黎巴嫩",
    "DAM": "大马士革, 叙利亚",
    "BGW": "巴格达, 伊拉克",
    "TBS": "第比利斯, 格鲁吉亚",
    "GYD": "巴库, 阿塞拜疆",
    "TAS": "塔什干, 乌兹别克斯坦",
    "ALA": "阿拉木图, 哈萨克斯坦",

    // 北美
    "LAX": "洛杉矶, 美国",
    "SFO": "旧金山, 美国",
    "SEA": "西雅图, 美国",
    "DEN": "丹佛, 美国",
    "ORD": "芝加哥, 美国",
    "DFW": "达拉斯, 美国",
    "ATL": "亚特兰大, 美国",
    "SJC": "圣何塞, 美国",
    "EWR": "纽瓦克,美国",
    "JFK": "纽约, 美国",
    "MIA": "迈阿密, 美国",
    "PDX": "波特兰, 美国",
    "YYZ": "多伦多, 加拿大",
    "YVR": "温哥华, 加拿大",
    "YUL": "蒙特利尔, 加拿大",
    "MEX": "墨西哥城, 墨西哥",
    "GDL": "瓜达拉哈拉, 墨西哥",
    "CUN": "坎昆, 墨西哥",
    "SAL": "圣萨尔瓦多, 萨尔瓦多",
    "GUA": "危地马拉城, 危地马拉",
    "TGU": "特古西加尔巴, 洪都拉斯",
    "SAP": "圣佩德罗苏拉, 洪都拉斯",
    "MGA": "马那瓜, 尼加拉瓜",
    "PTY": "巴拿马城, 巴拿马",
    "HAV": "哈瓦那, 古巴",
    "KIN": "金斯敦, 牙买加",
    "NAS": "拿骚, 巴哈马",
    "SDQ": "圣多明各, 多米尼加",
    "PAP": "太子港, 海地",
    "BGI": "布里奇顿, 巴巴多斯",
    "POS": "西班牙港, 特立尼达和多巴哥",

    // 欧洲
    "LHR": "伦敦, 英国",
    "MAN": "曼彻斯特, 英国",
    "EDI": "爱丁堡, 英国",
    "AMS": "阿姆斯特丹, 荷兰",
    "FRA": "法兰克福, 德国",
    "MUC": "慕尼黑, 德国",
    "CDG": "巴黎, 法国",
    "MRS": "马赛, 法国",
    "MAD": "马德里, 西班牙",
    "BCN": "巴塞罗那, 西班牙",
    "FCO": "罗马, 意大利",
    "MXP": "米兰, 意大利",
    "ZRH": "苏黎世, 瑞士",
    "VIE": "维也纳, 奥地利",
    "PRG": "布拉格, 捷克",
    "WAW": "华沙, 波兰",
    "IST": "伊斯坦布尔, 土耳其",
    "DME": "莫斯科, 俄罗斯",
    "LED": "圣彼得堡, 俄罗斯",
    "DUB": "都柏林, 爱尔兰",
    "BRU": "布鲁塞尔, 比利时",
    "CPH": "哥本哈根, 丹麦",
    "OSL": "奥斯陆, 挪威",
    "ARN": "斯德哥尔摩, 瑞典",
    "HEL": "赫尔辛基, 芬兰",
    "LIS": "里斯本, 葡萄牙",
    "OPO": "波尔图, 葡萄牙",
    "ATH": "雅典, 希腊",
    "SOF": "索菲亚, 保加利亚",
    "BUD": "布达佩斯, 匈牙利",
    "BEG": "贝尔格莱德, 塞尔维亚",
    "ZAG": "萨格勒布, 克罗地亚",
    "LJU": "卢布尔雅那, 斯洛文尼亚",
    "TGD": "波德戈里察, 黑山",
    "SKP": "斯科普里, 北马其顿",
    "OTP": "布加勒斯特, 罗马尼亚",
    "KIV": "基希讷乌, 摩尔多瓦",
    "VNO": "维尔纽斯, 立陶宛",
    "RIX": "里加, 拉脱维亚",
    "TLL": "塔林, 爱沙尼亚",

    // 大洋洲
    "SYD": "悉尼, 澳大利亚",
    "MEL": "墨尔本, 澳大利亚",
    "BNE": "布里斯班, 澳大利亚",
    "PER": "珀斯, 澳大利亚",
    "AKL": "奥克兰, 新西兰",
    "WLG": "惠灵顿, 新西兰",
    "NOU": "努美阿, 新喀里多尼亚",
    "SUV": "苏瓦, 斐济",
    "TBU": "努库阿洛法, 汤加",
    "APW": "阿皮亚, 萨摩亚",
    "RAR": "阿瓦鲁阿, 库克群岛",
    "HIR": "霍尼亚拉, 所罗门群岛",
    "VLI": "维拉港, 瓦努阿图",
    "FUN": "富纳富提, 图瓦卢",
    "MAJ": "马朱罗, 马绍尔群岛",
    "PNI": "科洛尼亚, 密克罗尼西亚",
    "YAP": "雅浦, 密克罗尼西亚",
    "KWA": "夸贾林, 马绍尔群岛",

    // 南美
    "GRU": "圣保罗, 巴西",
    "GIG": "里约热内卢, 巴西",
    "EZE": "布宜诺斯艾利斯, 阿根廷",
    "SCL": "圣地亚哥, 智利",
    "LIM": "利马, 秘鲁",
    "BOG": "波哥大, 哥伦比亚",
    "GYE": "瓜亚基尔, 厄瓜多尔",
    "UIO": "基多, 厄瓜多尔",
    "CCS": "加拉加斯, 委内瑞拉",
    "ASU": "亚松森, 巴拉圭",
    "MVD": "蒙得维的亚, 乌拉圭",
    "CUR": "威廉斯塔德, 库拉索",
    "PBM": "帕拉马里博, 苏里南",
    "GEO": "乔治敦, 圭亚那",
    "SXM": "菲利普斯堡, 圣马丁岛",

    // 非洲
    "JNB": "约翰内斯堡, 南非",
    "CPT": "开普敦, 南非",
    "LOS": "拉各斯, 尼日利亚",
    "NBO": "内罗毕, 肯尼亚",
    "CAI": "开罗, 埃及",
    "TNR": "塔那那利佛, 马达加斯加",
    "CMN": "卡萨布兰卡, 摩洛哥",
    "TUN": "突尼斯市, 突尼斯",
    "ALG": "阿尔及尔, 阿尔及利亚",
    "ADD": "亚的斯亚贝巴, 埃塞俄比亚",
    "DAR": "达累斯萨拉姆, 坦桑尼亚",
    "KGL": "基加利, 卢旺达",
    "EBB": "坎帕拉, 乌干达",
    "LAD": "罗安达, 安哥拉",
    "ACC": "阿克拉, 加纳",
    "ABV": "阿布贾, 尼日利亚",
    "BJL": "班珠尔, 冈比亚",
    "DKR": "达喀尔, 塞内加尔",
    "BKO": "巴马科, 马里",
    "OUA": "瓦加杜古, 布基纳法索",
    "NIM": "尼亚美, 尼日尔",
    "LFW": "洛美, 多哥",
    "LBV": "利伯维尔, 加蓬",
    "BZV": "布拉柴维尔, 刚果共和国",
    "FIH": "金沙萨, 刚果民主共和国",
    "MPM": "马普托, 莫桑比克",
    "LUN": "卢萨卡, 赞比亚",
    "HRE": "哈拉雷, 津巴布韦",
    "GBE": "哈博罗内, 博茨瓦纳",
    "WDH": "温得和克, 纳米比亚",
    "MTS": "曼齐尼, 斯威士兰",
    "MSU": "马塞卢, 莱索托",
    "SEZ": "维多利亚, 塞舌尔",
    "MRU": "路易港, 毛里求斯"
};

// 检测 CDN 节点（保持不变）
function detectCDNNode() {
    const cdnElement = document.getElementById("cdn");
    
    fetch('/cdn-cgi/trace')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .then(data => {
            // 提取colo代码
            const coloMatch = data.match(/colo=([A-Z]+)/);
            if (!coloMatch) {
                throw new Error('No colo code found');
            }
            
            const coloCode = coloMatch[1];
            const location = cdnLocationMap[coloCode] || `节点中文未收录 (${coloCode})`;
            
            // 更新显示
            cdnElement.textContent = location;
            cdnElement.className = "";
        })
        .catch(error => {
            console.error("CDN检测错误:", error);
            cdnElement.textContent = "本地访问 (未检测到CDN)";
            cdnElement.className = "error";
        });
}

// 页面加载完成后开始检测（保持不变）
document.addEventListener("DOMContentLoaded", detectCDNNode);